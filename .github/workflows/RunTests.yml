name: Run Tests
on:
  workflow_dispatch:    
jobs:    
  build:
    runs-on: ubuntu-latest    
    steps:
    - name: Check out code
      uses: actions/checkout@v1
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 5.0.103
    - name: Build with dotnet
      run: |
        dotnet build webtest1/webtest1.csproj 
        dotnet build webtest1.Tests/webtest1.Tests.csproj        
    - name: Install report generator
      run: dotnet tool install dotnet-reportgenerator-globaltool --version 4.8.12 --tool-path $DOTNET_ROOT/tools
    - name: Run Tests
      run: |
        dotnet test /p:CollectCoverage=true /p:CoverletOutput=$DOTNET_ROOT/BuildReports/Coverage/ /p:CoverletOutputFormat=cobertura 
        reportgenerator -reports:$DOTNET_ROOT/BuildReports/Coverage/coverage.cobertura.xml -targetdir:$DOTNET_ROOT/BuildReports/Coverage -reporttypes:"HTML;HTMLSummary"   
    - name: Export Artifacts
      uses: actions/upload-artifact@v2      
      with:	      
        name: Code Coverage
        path: ~/.dotnet/BuildReports/Coverage/*
    

